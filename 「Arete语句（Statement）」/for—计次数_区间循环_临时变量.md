
# ğŸ” for â€” è®¡æ¬¡æ•° / åŒºé—´å¾ªç¯ / éå†åˆ—è¡¨ï¼ˆæœ€æ–°ç‰ˆï¼‰

> æ›´æ–°ï¼š2025-11-12 03:30:20  
> é€‚é…å®ç°ï¼š`ForStatement`ï¼ˆæ”¯æŒ **æ¬¡æ•°**ã€**æ•°å€¼åŒºé—´**ã€**éå†å˜é‡åˆ—è¡¨/æ•°ç»„/Map**ï¼›æä¾› `var/index` ä¸´æ—¶å˜é‡ï¼Œè‡ªåŠ¨å¿«ç…§è¿˜åŸï¼›æ•°å€¼æ™ºèƒ½è½¬å‹ Int/Longï¼‰

---

## ğŸ“– åŠŸèƒ½ç®€ä»‹

`for` ç”¨æ¥**é‡å¤æ‰§è¡Œå­è¯­å¥å—**ï¼š
- **æ¬¡æ•°å¾ªç¯**ï¼šæŒ‰ `times` / `count` æ‰§è¡Œ N æ¬¡ï¼ˆè¿­ä»£ 0..N-1ï¼‰ï¼›
- **åŒºé—´å¾ªç¯**ï¼šæŒ‰ `from..to`ã€æ­¥é•¿ `step`ï¼ˆå«ç«¯ç‚¹ï¼Œå¸¦æµ®ç‚¹å®¹å·®ï¼‰ï¼›
- **éå†å¾ªç¯**ï¼šéå† `ctx.vars` ä¸­çš„åˆ—è¡¨ / æ•°ç»„ / åºåˆ— / åŸç”Ÿæ•°ç»„ / Mapã€‚

è¿­ä»£æ—¶å¯æŠŠ **å½“å‰å€¼** å†™å…¥ `var`ï¼ŒæŠŠ **å½“å‰ä¸‹æ ‡** å†™å…¥ `index`ï¼Œåœ¨å­å—ä¸­é€šè¿‡å ä½ç¬¦å¼•ç”¨ï¼ˆå¦‚ `${i}` / `${idx}`ï¼‰ã€‚

---

## âš™ï¸ è¯­æ³•

### æ–¹å¼ä¸€ï¼šæŒ‰æ¬¡æ•°ï¼ˆ`times`/`count`ï¼‰

```plain
for { times = 5; var = "i" } {
  # å¾ªç¯ä½“ï¼›i ä¾æ¬¡ä¸º 0,1,2,3,4
}
```
ç­‰ä»·ï¼š
```plain
for { count = 5; as = "i" } { ... }
```

---

### æ–¹å¼äºŒï¼šæŒ‰åŒºé—´ï¼ˆ`from`/`to`/`step`ï¼‰

```plain
for { from = 0; to = 10; step = 2; var = "i" } {
  # i = 0,2,4,6,8,10
}
```
**è§„åˆ™**
- è‹¥æœªå†™ `step`ï¼šæ ¹æ®æ–¹å‘è‡ªåŠ¨å– `+1` æˆ– `-1`ï¼›
- è‹¥ `step = 0`ï¼šè‡ªåŠ¨çº æ­£ä¸ºæŒ‰æ–¹å‘çš„ `Â±1`ï¼›
- **å«ç«¯ç‚¹**ï¼š`to` ä¼šè¢«æ‰§è¡Œï¼ˆæµ®ç‚¹å®¹å·® `1e-9`ï¼‰ï¼›
- è‹¥ `step` ä¸æ–¹å‘ç¬¦å·ä¸åŒ¹é…ï¼Œå¾ªç¯**ä¸ä¼šæ‰§è¡Œ**ã€‚

---

### æ–¹å¼ä¸‰ï¼šéå†å˜é‡é‡Œçš„é›†åˆï¼ˆ`list` / `of` / `in` / `over` / `items`ï¼‰

```plain
# ctx.vars["targets"] æ˜¯ List<Entity>
for { list = "targets"; var = "t"; index = "idx" } {
  message { text = "&7ç¬¬ ${idx} ä¸ªç›®æ ‡: ${t}" }
}
```

**å¯éå†çš„æ¥æº**ï¼ˆç»Ÿä¸€å†™åˆ° `list` / `of` / `in` / `over` / `items` ä»»ä¸€é”®ï¼‰ï¼š
- `Iterable<*>`ï¼ˆå¦‚ `List`ã€`Set`â€¦â€¦ï¼‰
- `Sequence<*>`
- `Array<*>`
- åŸç”Ÿæ•°ç»„ï¼š`IntArray` / `LongArray` / `DoubleArray` / `FloatArray` / `BooleanArray` / `ShortArray` / `ByteArray` / `CharArray`
- `Map<*, *>`ï¼ˆéå† `entry`ï¼Œå³ `Map.Entry(key, value)`ï¼›å­å—ä¸­ `${t.key}` / `${t.value}` å¯è®¿é—®ï¼‰

> è‹¥å˜é‡ä¸å­˜åœ¨æˆ–ç±»å‹ä¸åŒ¹é…ï¼Œå°†è·³è¿‡éå†å¹¶**å›é€€ä¸ºä¸æ‰§è¡Œ**ã€‚

---

## ğŸ”¢ å‚æ•°è¯´æ˜

| é”®                                       | ç±»å‹     | è¯´æ˜                                               |
|-----------------------------------------|--------|--------------------------------------------------|
| `times` / `count`                       | Int    | æ‰§è¡Œæ¬¡æ•°ï¼›æä¾›ä»»ä¸€å³é‡‡ç”¨ 0..(n-1) è¿­ä»£ï¼Œå¿½ç•¥ `from/to/step`       |
| `from`                                  | Double | åŒºé—´èµ·å§‹ï¼ˆé»˜è®¤ `0`ï¼‰                                     |
| `to`                                    | Double | åŒºé—´ç»“æŸï¼ˆé»˜è®¤ç­‰äº `from`ï¼Œå³åªæ‰§è¡Œä¸€æ¬¡ï¼‰                         |
| `step`                                  | Double | æ­¥é•¿ï¼›é»˜è®¤æŒ‰æ–¹å‘å– `Â±1`ï¼›ä¸º `0` ä¼šè¢«çº æ­£ä¸ºæ–¹å‘ `Â±1`                |
| `list` / `of` / `in` / `over` / `items` | String | **éå†æ¨¡å¼**ï¼šæŒ‡å®šå˜é‡åï¼Œä» `ctx.vars[name]` å–é›†åˆ            |
| `var` / `as`                            | String | å½“å‰**å€¼å˜é‡**çš„å˜é‡åï¼ˆå†™å…¥ `ctx.vars[var]`ï¼‰ï¼›ç¤ºä¾‹ `${i}`      |
| `index` / `idx` / `index-var`           | String | å½“å‰**ä¸‹æ ‡å˜é‡**çš„å˜é‡åï¼ˆå†™å…¥ `ctx.vars[index]`ï¼‰ï¼›ç¤ºä¾‹ `${idx}` |
| `type`                                  | String | é»˜è®¤seq,å¯å¡«:seq / parallel (ä»£è¡¨ä¸¤ç§æ‰§è¡Œæ–¹å¼: é¡ºåºæ‰§è¡Œ/åŒæ—¶æ‰§è¡Œ)    |

### å˜é‡è¡Œä¸ºï¼ˆå¿«ç…§ä¸æ™ºèƒ½ç±»å‹ï¼‰
- æ¯æ¬¡å¾ªç¯å‰ä¼šæŠŠ**å½“å‰å€¼**å†™å…¥ `ctx.vars[var]`ï¼ŒæŠŠ**å½“å‰ä¸‹æ ‡**å†™å…¥ `ctx.vars[index]`ï¼›
- **æ™ºèƒ½è½¬å‹**ï¼šåŒºé—´æ¨¡å¼ä¸‹çš„æ•°å€¼è‹¥æ¥è¿‘æ•´æ•°ï¼Œä¼šè‡ªåŠ¨è½¬ä¸º `Int`/`Long`ï¼Œå¦åˆ™ä¿ç•™ `Double`ï¼›
- å¾ªç¯ç»“æŸåä¼š**è‡ªåŠ¨è¿˜åŸ**ï¼š
    - è‹¥å˜é‡åä¹‹å‰å·²å­˜åœ¨ï¼Œæ¢å¤ä¸ºæ—§å€¼ï¼›
    - è‹¥ä¹‹å‰ä¸å­˜åœ¨ï¼Œä» `ctx.vars` ç§»é™¤ã€‚

---

## âš¡ å®ç”¨ç¤ºä¾‹

### â‘  æ‰§è¡Œ 5 æ¬¡ï¼Œå±•ç¤ºè®¡æ•°
```plain
for { times = 5; var = "i" } {
  message { text = "&7ç¬¬ ${i} æ¬¡é‡Šæ”¾ç²’å­" }
  particle { type = "crit" at = "@self" }
}
```

### â‘¡ é€’å¢ä½ç§»ï¼ˆè¿è´¯å†²åˆºæ„Ÿï¼‰
```plain
for { from = 0; to = 0.8; step = 0.2; var = "t" } {
  velocity { x = 0 y = 0 z = 0.2 add = true }
  delay 1
}
```

### â‘¢ ç¯å½¢å‡»é€€ï¼ˆç”¨è®¡æ•°é©±åŠ¨å¤šæ¬¡ knockbackï¼‰
```plain
target-entity { center = "@self" radius = 4 type = "living" includeSelf = false storeList = "victims" }
for { times = 3; var = "round" } {
  knockback { targetVar = "victims" s = 0.6 y = 0.22 }
  sound { key = "entity.player.attack.knockback" v = 1 p = 1 at = "@self" }
  delay 2
}
```

### â‘£ é€’å‡å¾ªç¯ï¼ˆå€’è®¡æ—¶ï¼‰
```plain
for { from = 3; to = 1; step = -1; var = "sec" } {
  title { text = "&e${sec}" }
  delay 20
}
message { text = "&aGo!" }
```

### â‘¤ éå†åˆ—è¡¨å˜é‡
```plain
# ctx.vars["points"] æ˜¯ List<Location>
for { list = "points"; var = "p"; index = "i" } {
  particle { type = "END_ROD"; count = 1; at = "${p}" }
  ifchain {
    case { cond = "var.i % 4 == 0" } { sound { key = "block.note_block.pling" at = "${p}" } }
  }
}
```

### â‘¥ éå† Mapï¼ˆentry çš„ key/valueï¼‰
```plain
# ctx.vars["attrs"] æ˜¯ Map<String, Double>
for { of = "attrs"; var = "e"; index = "i" } {
  message { text = "&7ç¬¬${i}é¡¹: &f${e.key} = ${e.value}" }
}
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®
- **é…åˆ `delay` åˆ†å¸§**ï¼šåœ¨åŒºé—´/æ¬¡æ•°å¾ªç¯é‡ŒåŠ  `delay`ï¼Œå¯å®ç°æ›´å¹³æ»‘çš„åŠ¨ç”»ï¼›
- **æ§åˆ¶è§„æ¨¡**ï¼šé¿å…è¿‡å¤§è¿­ä»£ï¼ˆå•æ¬¡å»ºè®® â‰¤ 100 æ¬¡ï¼‰ï¼Œæˆ–ä½¿ç”¨æ­¥é•¿/æŠ½æ ·ï¼›
- **å˜é‡ä¸æ³„æ¼**ï¼š`var/index` åœ¨å¾ªç¯ç»“æŸåä¼šè‡ªåŠ¨è¿˜åŸ/ç§»é™¤ï¼Œä¸æ±¡æŸ“ä¸Šä¸‹æ–‡ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹
- `step = 0` ä¼šè¢«è‡ªåŠ¨çº æ­£ä¸ºæ–¹å‘ `Â±1`ï¼›è‹¥ `step` ä¸æ–¹å‘ä¸åŒ¹é…ï¼ˆå¦‚ `from < to` ä½† `step < 0`ï¼‰ï¼Œå¾ªç¯å°†**ä¸æ‰§è¡Œ**ï¼›
- éå†æ¨¡å¼ä¸‹ï¼Œè‹¥å˜é‡ä¸å­˜åœ¨æˆ–ä¸æ˜¯å¯éå†ç±»å‹ï¼Œå°†**è·³è¿‡**å¾ªç¯ä½“ï¼›
- Map éå†æä¾›çš„æ˜¯ `entry` å¯¹è±¡ï¼Œå­å—ä¸­å¯ä½¿ç”¨ `${e.key}` / `${e.value}` è®¿é—®ã€‚

---

## ğŸ”— ç›¸å…³è¯­å¥
- [â³ delay - å»¶è¿Ÿæ‰§è¡Œ](â³delayâ€”å»¶è¿Ÿæ‰§è¡Œåç»­è¯­å¥.md)
- [ğŸ§  ifchain - å¤šåˆ†æ”¯æ¡ä»¶](ifchainâ€”å¤šåˆ†æ”¯æ¡ä»¶æ‰§è¡Œ_caseâ€¦elseé“¾.md)
- [ğŸŒŒ particle - ç²’å­ç‰¹æ•ˆ](particleâ€”ç²’å­ç‰¹æ•ˆè¯­å¥.md)

---

<div style="text-align: center; padding: 20px 0; color: #999; font-size: 12px; border-top: 1px solid #eee; margin-top: 50px;">
  <p>ğŸ“ æ›´æ–°æ—¶é—´: 2025-11-12 03:30:20</p>
</div>
